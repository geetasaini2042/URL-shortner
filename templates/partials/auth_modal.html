<div id="authModal" class="modal" aria-hidden="true">
    <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="authTitle">
        <h2 id="authTitle">Create your account</h2>
        <form id="authForm" onsubmit="submitAuth(); return false;">
            <p id="authError" role="alert"></p>
            <label for="authEmail">Email</label>
            <input type="email" id="authEmail" placeholder="you@example.com" autocomplete="email" />
            <label for="authPassword">Password</label>
            <input type="password" id="authPassword" placeholder="At least 8 characters" autocomplete="new-password" />
            <div id="userNameRow">
                <label for="authUserName">User name</label>
                <input type="text" id="authUserName" placeholder="Your display name" autocomplete="name" />
            </div>
            <div class="actions">
                <button type="submit" class="primary" id="primaryBtn">Register</button>
            </div>
            <div class="toggle">
                <span id="toggleText">Already have an account?</span>
                <button type="button" onclick="toggleAuthMode()" id="toggleBtn">Login</button>
            </div>
        </form>
    </div>
    <script>
        let authMode = 'register';
        function openAuthModal(mode='register'){
            setAuthMode(mode);
            document.getElementById('authError').innerText='';
            const modal = document.getElementById('authModal');
            modal.style.display='flex';
            modal.setAttribute('aria-hidden','false');
            const email = document.getElementById('authEmail');
            setTimeout(() => email && email.focus(), 0);
        }
        function closeAuthModal(){
            const modal = document.getElementById('authModal');
            modal.style.display='none';
            modal.setAttribute('aria-hidden','true');
        }
        function setAuthMode(mode){
            authMode = mode;
            const isRegister = mode === 'register';
            document.getElementById('authTitle').innerText = isRegister ? 'Create your account' : 'Welcome back';
            document.getElementById('userNameRow').style.display = isRegister ? 'block' : 'none';
            document.getElementById('primaryBtn').innerText = isRegister ? 'Register' : 'Login';
            document.getElementById('toggleText').innerText = isRegister ? 'Already have an account?' : 'New here?';
            document.getElementById('toggleBtn').innerText = isRegister ? 'Login' : 'Register';
            const pwd = document.getElementById('authPassword');
            if(pwd){ pwd.setAttribute('autocomplete', isRegister ? 'new-password' : 'current-password'); }
        }
        function toggleAuthMode(){ setAuthMode(authMode === 'register' ? 'login' : 'register'); }
        // Close on overlay click
        document.addEventListener('click', function(ev){
            const modal = document.getElementById('authModal');
            if(ev.target === modal){ closeAuthModal(); }
        });
        // Close on Escape
        document.addEventListener('keydown', function(ev){ if(ev.key === 'Escape'){ closeAuthModal(); }});
    </script>
</div>


